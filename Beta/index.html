<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coach Chris CRC</title>
    <meta name="theme-color" content="#121412">
    
    <!-- PWA Manifest Data URI -->
    <link rel="manifest" href='data:application/json,{"name":"Coach Chris CRC","short_name":"ChrisCRC","start_url":"index.html","display":"standalone","background_color":"#121412","theme_color":"#808a5c","icons":[{"src":"https://via.placeholder.com/192/808a5c/ffffff?text=CRC","sizes":"192x192","type":"image/png"}]}'>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        :root { --olive: #808a5c; --bg: #121412; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg); color: #fff; overflow: hidden; margin: 0; display: flex; align-items: center; justify-content: center; height: 100vh; }
        
        .bar-container { width: 280px; height: 4px; background: rgba(255, 255, 255, 0.05); border-radius: 10px; overflow: hidden; margin-top: 2rem; border: 1px solid rgba(128, 138, 92, 0.2); }
        #progress-bar { width: 0%; height: 100%; transition: width 0.1s ease-out; background: linear-gradient(135deg, var(--olive) 0%, #556b2f 100%); box-shadow: 0 0 15px rgba(128, 138, 92, 0.5); }
        
        .icon-container { position: relative; display: flex; justify-content: center; align-items: center; background: rgba(128, 138, 92, 0.05); border-radius: 50%; border: 1px solid rgba(128, 138, 92, 0.1); width: 140px; height: 140px; overflow: hidden; }
        .heartrate-path { stroke-dasharray: 120; stroke-dashoffset: 120; animation: move-right 1.4s linear infinite; }
        @keyframes move-right { 0% { stroke-dashoffset: 120; } 100% { stroke-dashoffset: -120; } }
        
        #install-interface { 
            display: none; 
            position: absolute; 
            bottom: 12%; 
            width: 100%; 
            padding: 0 32px; 
            animation: slideUp 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        }
        @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>

    <div class="flex flex-col items-center text-center p-6 w-full max-w-md">
        <!-- Icon -->
        <div id="main-icon" class="icon-container mb-10 transition-transform duration-700">
            <svg width="140" height="140" viewBox="0 0 24 24" fill="none" stroke="#808a5c" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <path d="M0 12h2l1.5-4 1.5 8 2-14 2.5 20 2-10 2 4h10.5" opacity="0.1"></path>
                <path d="M0 12h2l1.5-4 1.5 8 2-14 2.5 20 2-10 2 4h10.5" class="heartrate-path"></path>
            </svg>
        </div>

        <!-- Branding -->
        <h1 class="text-4xl md:text-5xl font-black uppercase tracking-tighter mb-2">
            Coach Chris <span style="color:var(--olive)">CRC</span>
        </h1>
        <p class="text-gray-500 text-[10px] uppercase tracking-[0.3em] font-bold">FITTER. STRONGER. BETTER.</p>

        <!-- Loader -->
        <div id="loader-ui" class="flex flex-col items-center w-full">
            <div class="bar-container">
                <div id="progress-bar"></div>
            </div>
            <div id="status-text" class="text-[10px] text-gray-500 mt-6 font-mono uppercase tracking-widest opacity-70">Initializing...</div>
        </div>

        <!-- PWA Install Prompt -->
        <div id="install-interface">
            <button id="install-btn" class="w-full bg-[#808a5c] text-white py-4 rounded-xl font-black text-xs tracking-[0.2em] uppercase shadow-lg shadow-olive/20 hover:scale-[1.02] active:scale-[0.98] transition-all">
                Install App & Launch
            </button>
            <button id="skip-btn" class="mt-6 text-gray-500 text-[9px] uppercase tracking-[0.3em] font-bold hover:text-white transition-colors">
                Continue to Website
            </button>
        </div>
    </div>

    <script>
        // Inline Service Worker
        const swCode = `
            const CACHE = 'chris-crc-v2';
            self.addEventListener('install', e => self.skipWaiting());
            self.addEventListener('fetch', e => e.respondWith(fetch(e.request)));
        `;
        const swBlob = new Blob([swCode], {type: 'application/javascript'});
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register(URL.createObjectURL(swBlob), {scope: './'});
        }

        const targetUrl = "https://coachchriscrc.carrd.co";
        const progressBar = document.getElementById('progress-bar');
        const statusText = document.getElementById('status-text');
        const installInterface = document.getElementById('install-interface');
        const installBtn = document.getElementById('install-btn');
        const skipBtn = document.getElementById('skip-btn');
        const loaderUi = document.getElementById('loader-ui');
        const mainIcon = document.getElementById('main-icon');

        let deferredPrompt;
        let width = 0;
        
        // Check if app is already running as PWA
        const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true;

        // Capture the install prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
        });

        function handleCompletion() {
            // If already in PWA or browser doesn't support/offer install prompt, just redirect
            if (isStandalone || !deferredPrompt) {
                window.location.replace(targetUrl);
            } else {
                // Pause for installation offer
                statusText.innerText = "System Ready";
                loaderUi.classList.add('opacity-0');
                loaderUi.style.pointerEvents = 'none';
                
                // Shift icon up slightly to make room for buttons
                mainIcon.style.transform = 'translateY(-20px) scale(0.9)';
                
                // Show install buttons
                setTimeout(() => {
                    installInterface.style.display = 'block';
                }, 300);
            }
        }

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    console.log('User installed the PWA');
                }
                deferredPrompt = null;
                window.location.replace(targetUrl);
            }
        });

        skipBtn.addEventListener('click', () => {
            window.location.replace(targetUrl);
        });

        function updateProgress() {
            width += Math.random() * 4.5;
            if (width >= 100) {
                width = 100;
                progressBar.style.width = '100%';
                statusText.innerText = "Execute";
                setTimeout(handleCompletion, 500);
            } else {
                progressBar.style.width = width + '%';
                statusText.innerText = `Synchronizing // ${Math.floor(width)}%`;
                setTimeout(() => requestAnimationFrame(updateProgress), 30);
            }
        }

        // Start loading
        window.onload = () => setTimeout(updateProgress, 600);
    </script>
</body>
</html>
